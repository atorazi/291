<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ÎØ∏Î°ú</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  height: 100%;
  background: #0b1426;
  color: #eaf2ff;
  font-family: "Pretendard", sans-serif;
  text-align: center;
}

/* Ï∫îÎ≤ÑÏä§: ÌôîÎ©¥ Ï†ÑÏ≤¥ Ï±ÑÏõÄ */
#mazeCanvas {
  width: 100%;
  height: 100%;
  display: block;
  border: 3px solid #1e396e;
  background: #0a1225;
  border-radius: 8px;
}

/* ÏÉà ÎØ∏Î°ú Î≤ÑÌäº */
#generateBtn {
  padding: 8px 16px;
  border-radius: 8px;
  border: none;
  background: #ffd447;
  color: #1a1300;
  font-weight: 700;
  cursor: pointer;
  position: absolute;
  top: 10px;
  right: 10px;
  z-index: 50;
}
#generateBtn:hover { opacity: 0.9; }

/* Î™®Î∞îÏùº Ï°∞Ïù¥Ïä§Ìã± */
#joystick {
  position: fixed;
  bottom: 40px;
  left: 40px;
  width: 140px;
  height: 140px;
  background: rgba(255,255,255,0.07);
  border: 2px solid rgba(255,255,255,0.15);
  border-radius: 50%;
  touch-action: none;
  z-index: 999;
}
#stick {
  position: absolute;
  width: 60px;
  height: 60px;
  background: rgba(255,212,71,0.85);
  border-radius: 50%;
  left: 40px;
  top: 40px;
  transition: 0.05s;
  touch-action: none;
}
</style>
</head>

<body>

<button id="generateBtn">üîÑ ÏÉàÎ°úÏö¥ ÎØ∏Î°ú ÏÉùÏÑ±</button>

<canvas id="mazeCanvas"></canvas>

<!-- Î™®Î∞îÏùº Ï°∞Ïù¥Ïä§Ìã± -->
<div id="joystick"><div id="stick"></div></div>

<script>
// =========================
// Ï∫îÎ≤ÑÏä§ ÏÑ§Ï†ï (Ï†ÑÏ≤¥ ÌôîÎ©¥)
// =========================
const canvas = document.getElementById("mazeCanvas");
const ctx = canvas.getContext("2d");

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  cellSize = Math.floor(canvas.width / cols);
  if (cellSize * rows > canvas.height) {
    cellSize = Math.floor(canvas.height / rows);
  }
  drawMaze();
}
window.addEventListener("resize", resizeCanvas);

// =========================
// Ï†ÑÏó≠ Î≥ÄÏàò
// =========================
let rows = 25;
let cols = 25;
let cellSize = 30;

let grid = [];
let stack = [];
let player = { r: 0, c: 0 };
let exit = { r: rows - 1, c: cols - 1 };

// =========================
// ÏÖÄ ÏÉùÏÑ±
// =========================
class Cell {
  constructor(r, c) {
    this.r = r;
    this.c = c;
    this.walls = { top: true, right: true, bottom: true, left: true };
    this.visited = false;
  }

  draw() {
    const x = this.c * cellSize;
    const y = this.r * cellSize;

    ctx.strokeStyle = "#eaf2ff";
    ctx.lineWidth = 2;

    if (this.walls.top)    drawLine(x, y, x + cellSize, y);
    if (this.walls.right)  drawLine(x + cellSize, y, x + cellSize, y + cellSize);
    if (this.walls.bottom) drawLine(x, y + cellSize, x + cellSize, y + cellSize);
    if (this.walls.left)   drawLine(x, y, x, y + cellSize);
  }
}

function drawLine(x1,y1,x2,y2){
  ctx.beginPath();
  ctx.moveTo(x1,y1);
  ctx.lineTo(x2,y2);
  ctx.stroke();
}

// =========================
// DFS ÎØ∏Î°ú ÏÉùÏÑ±
// =========================
function generateMaze() {
  grid = [];
  stack = [];

  for (let r = 0; r < rows; r++) {
    let row = [];
    for (let c = 0; c < cols; c++) row.push(new Cell(r, c));
    grid.push(row);
  }

  let current = grid[0][0];
  current.visited = true;
  stack.push(current);

  while (stack.length > 0) {
    let next = checkNeighbors(current);

    if (next) {
      next.visited = true;
      stack.push(current);
      removeWalls(current, next);
      current = next;
    } else {
      current = stack.pop();
    }
  }
}

function checkNeighbors(cell) {
  let { r, c } = cell;
  let arr = [];

  if (r > 0 && !grid[r - 1][c].visited) arr.push(grid[r - 1][c]);
  if (c < cols - 1 && !grid[r][c + 1].visited) arr.push(grid[r][c + 1]);
  if (r < rows - 1 && !grid[r + 1][c].visited) arr.push(grid[r + 1][c]);
  if (c > 0 && !grid[r][c - 1].visited) arr.push(grid[r][c - 1]);

  return arr.length ? arr[Math.floor(Math.random() * arr.length)] : undefined;
}

function removeWalls(a, b) {
  let dx = a.c - b.c;
  let dy = a.r - b.r;

  if (dx === 1) { a.walls.left = false; b.walls.right = false; }
  if (dx === -1) { a.walls.right = false; b.walls.left = false; }

  if (dy === 1) { a.walls.top = false; b.walls.bottom = false; }
  if (dy === -1) { a.walls.bottom = false; b.walls.top = false; }
}

// =========================
// ÎØ∏Î°ú Í∑∏Î¶¨Í∏∞
// =========================
function drawMaze() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  grid.forEach(row => row.forEach(cell => cell.draw()));

  drawCircle(
    player.c * cellSize + cellSize/2,
    player.r * cellSize + cellSize/2,
    cellSize/3,
    "#68c3ff"
  );

  drawCircle(
    exit.c * cellSize + cellSize/2,
    exit.r * cellSize + cellSize/2,
    cellSize/3,
    "#ffd447"
  );
}

function drawCircle(x,y,r,color){
  ctx.beginPath();
  ctx.arc(x,y,r,0,Math.PI*2);
  ctx.fillStyle = color;
  ctx.fill();
}

// =========================
// Ïù¥Îèô Ï≤òÎ¶¨
// =========================
document.addEventListener("keydown", (e) => {
  let k = e.key.toLowerCase();
  let cell = grid[player.r][player.c];

  if (k==="w" && !cell.walls.top)    player.r--;
  if (k==="s" && !cell.walls.bottom) player.r++;
  if (k==="a" && !cell.walls.left)   player.c--;
  if (k==="d" && !cell.walls.right)  player.c++;

  drawMaze();
  checkWin();
});

// =========================
// ÏäπÎ¶¨ Ï≤¥ÌÅ¨
// =========================
function checkWin() {
  if (player.r === exit.r && player.c === exit.c) {
    setTimeout(() => alert("üéâ ÎØ∏Í∂Å ÌÉàÏ∂ú ÏÑ±Í≥µ!"), 20);
  }
}

// =========================
// Í≤åÏûÑ Ï¥àÍ∏∞Ìôî
// =========================
function newGame() {
  generateMaze();
  player = { r: 0, c: 0 };
  exit = { r: rows - 1, c: cols - 1 };
  resizeCanvas();
  drawMaze();
}

document.getElementById("generateBtn").onclick = newGame;
newGame();

// =========================
// Î™®Î∞îÏùº Ï°∞Ïù¥Ïä§Ìã±
// =========================
const joy = document.getElementById("joystick");
const stick = document.getElementById("stick");

let dragging = false;
let center = { x:0, y:0 };

function simulateKey(k){
  document.dispatchEvent(new KeyboardEvent("keydown",{key:k}));
}

joy.addEventListener("pointerdown", e=>{
  dragging = true;
  center = {
    x: joy.offsetLeft + joy.offsetWidth/2,
    y: joy.offsetTop + joy.offsetHeight/2
  };
});

document.addEventListener("pointermove", e=>{
  if(!dragging) return;

  let dx = e.clientX - center.x;
  let dy = e.clientY - center.y;
  let dist = Math.sqrt(dx*dx + dy*dy);
  let max = 40;

  if (dist > max){
    dx = dx/dist * max;
    dy = dy/dist * max;
  }

  stick.style.left = `${40 + dx}px`;
  stick.style.top  = `${40 + dy}px`;

  if (Math.abs(dx) > Math.abs(dy)) {
    if (dx > 10) simulateKey("d");
    if (dx < -10) simulateKey("a");
  } else {
    if (dy > 10) simulateKey("s");
    if (dy < -10) simulateKey("w");
  }
});

document.addEventListener("pointerup", ()=>{
  dragging=false;
  stick.style.left="40px";
  stick.style.top="40px";
});
</script>

</body>
</html>
