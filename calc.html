<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ğŸ‚ ë¯¸ë…¸íƒ€ìš°ë¥´ìŠ¤ì˜ ì¥ë‚œê° </title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
:root {
  --bg:#0b1426;
  --panel:#0f1e3a;
  --soft:#11234a;
  --ring:#1e396e;
  --ink:#eaf2ff;
  --accent:#ffd447;
}
*{box-sizing:border-box;}
body{
  margin:0; padding:20px;
  background:var(--bg); color:var(--ink);
  font-family:"Pretendard","Malgun Gothic",system-ui,sans-serif;
}
.wrap{
  max-width:750px;
  margin:0 auto;
  background:var(--panel);
  padding:20px 24px;
  border:1px solid var(--ring);
  border-radius:16px;
  box-shadow:0 10px 25px rgba(0,0,0,.35);
}
h1{
  margin:0 0 22px; text-align:center;
  color:var(--accent); font-size:22px;
}
label{ font-size:14px; margin-bottom:4px; display:block; }
input{
  width:100%; padding:9px 10px;
  border-radius:10px;
  border:1px solid #263654;
  background:#0b1426; color:var(--ink);
  font-size:14px;
  outline:none;
}
input:focus{
  border-color:var(--accent);
  box-shadow:0 0 0 1px rgba(255,212,71,.35);
}
.row{ display:flex; gap:10px; margin-bottom:12px; }
.col{ flex:1; }

button{
  padding:10px 14px;
  border-radius:10px;
  cursor:pointer; font-weight:600;
  font-size:14px;
}
.btn-primary{
  background:linear-gradient(135deg,#ffd447,#ffba27);
  border:none; color:#1a1200;
}
.btn-ghost{
  background:transparent;
  border:1px solid #334466;
  color:var(--ink);
}

.result-box{
  margin-top:16px;
  white-space:pre-line;
  border-radius:12px;
  padding:14px;
  background:#0d1b36;
  border:1px solid #22406f;
  font-size:14px;
}

.hidden-input { display:none !important; }

.error{color:#ff6f91;}
.muted{color:#9fb1dd; font-size:12px;}

</style>
</head>

<body>
<div class="wrap">

<h1>ğŸ‚ ë¯¸ë…¸íƒ€ìš°ë¥´ìŠ¤ì˜ ì¥ë‚œê° - ì°¨ì´</h1>

<!-- 1) í˜íŠ¸ ì„ íƒ -->
<label>í« ì´ë¦„</label>
<input id="petName" list="petList" placeholder="í˜íŠ¸ ì´ë¦„..." />
<datalist id="petList"></datalist>
<p id="debugBox" class="muted">ë°ì´í„° ë¡œë”© ì¤‘...</p>

<!-- 2) So -->
<label style="margin-top:14px;">Sê¸‰ ì´ˆê¸°ì¹˜ </label>
<div class="row">
  <div class="col"><input id="soHp" readonly></div>
  <div class="col"><input id="soAtk" readonly></div>
  <div class="col"><input id="soDef" readonly></div>
  <div class="col"><input id="soAgi" readonly></div>
</div>

<!-- 3) Î” ì…ë ¥ -->
<label>ë‚´ í« ì´ˆê¸°ì¹˜ â€˜ì°¨ì´â€™ ì…ë ¥  
<span class="muted">(ì •ì„ +- ê°’ ì…ë ¥)</span></label>
<div class="row">
  <div class="col"><input id="dHp" placeholder="ì²´ë ¥"></div>
  <div class="col"><input id="dAtk" placeholder="ê³µê²©ë ¥"></div>
  <div class="col"><input id="dDef" placeholder="ë°©ì–´ë ¥"></div>
  <div class="col"><input id="dAgi" placeholder="ìˆœë°œë ¥"></div>
</div>

<!-- 4) ìˆ¨ê¹€ k/u/e -->
<input id="coefK" class="hidden-input">
<input id="uHp" class="hidden-input">
<input id="uAtk" class="hidden-input">
<input id="uDef" class="hidden-input">
<input id="uAgi" class="hidden-input">
<input id="coefE" class="hidden-input">

<!-- 5) Buttons -->
<div style="display:flex; gap:10px;">
  <button id="btnCalc" class="btn-primary">Rank8 í™•ë¥  ê³„ì‚°</button>
  <button id="btnClear" class="btn-ghost">ì´ˆê¸°í™”</button>
</div>

<!-- Result -->
<div id="resultBox" class="result-box">ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.</div>

</div>


<script>

const $ = id => document.getElementById(id);
let PET_DB = [];

/* -------- JSON ë¡œë”© -------- */
async function loadData(){
  const pets = await fetch("data/pets.json").then(r=>r.json());
  const spet = await fetch("data/spet.json").then(r=>r.json());

  PET_DB = spet.map(s => {
    const key = normalize(s["ì´ë¦„"]);
    const p = pets.find(x => normalize(x.name) === key);
    return {
      name:s["ì´ë¦„"],
      key,
      so:{
        hp:s["ì´ˆê¸°ì¹˜(stat)"]["ë‚´êµ¬ë ¥(HP)"],
        atk:s["ì´ˆê¸°ì¹˜(stat)"]["ê³µê²©ë ¥(Atk)"],
        def:s["ì´ˆê¸°ì¹˜(stat)"]["ë°©ì–´ë ¥(Def)"],
        agi:s["ì´ˆê¸°ì¹˜(stat)"]["ìˆœë°œë ¥(Agi)"]
      },
      sg:{
        hp:s["ì„±ì¥ë¥ (up)"]["ë‚´êµ¬ë ¥(HP)"],
        atk:s["ì„±ì¥ë¥ (up)"]["ê³µê²©ë ¥(Atk)"],
        def:s["ì„±ì¥ë¥ (up)"]["ë°©ì–´ë ¥(Def)"],
        agi:s["ì„±ì¥ë¥ (up)"]["ìˆœë°œë ¥(Agi)"]
      },
      k:p?.initnum ?? null,
      u:p ? {hp:p.hp, atk:p.atk, def:p.def, agi:p.agi} : null
    };
  });

  $("petList").innerHTML =
    PET_DB.map(x=>`<option value="${x.name}">`).join("");

  $("debugBox").textContent = "ë°ì´í„° ë¡œë“œ ì™„ë£Œ.";
}

function normalize(s){
  return String(s||"").replace(/\s+/g,"").toLowerCase();
}

/* -------- í« ì„ íƒ -------- */
function selectPet(name){
  const key = normalize(name);
  const p = PET_DB.find(x => x.key === key);
  if(!p){ $("debugBox").textContent="í« ì—†ìŒ"; return; }

  $("debugBox").textContent = `ì„ íƒë¨: ${p.name}`;

  $("soHp").value = p.so.hp;
  $("soAtk").value = p.so.atk;
  $("soDef").value = p.so.def;
  $("soAgi").value = p.so.agi;

  $("coefK").value = p.k;
  $("uHp").value = p.u.hp;
  $("uAtk").value = p.u.atk;
  $("uDef").value = p.u.def;
  $("uAgi").value = p.u.agi;
}

/* -------- lunya ì—”ì§„ -------- */
function enumerateAll(k, u, obs){
  let matches=0, rank8=0;
  const fac = k/100;

  for(let ar=-2; ar<=2; ar++)
  for(let dr=-2; dr<=2; dr++)
  for(let gr=-2; gr<=2; gr++)
  for(let hr=-2; hr<=2; hr++)
  for(let ab=0; ab<=10; ab++)
  for(let db=0; db<=10; db++)
  for(let gb=0; gb<=10; gb++){

    const hb = 10 - ab - db - gb;
    if(hb < 0 || hb > 10) continue;

    const A = u.atk + ar + ab;
    const D = u.def + dr + db;
    const G = u.agi + gr + gb;
    const H = u.hp + hr + hb;

    const iA=A*fac, iD=D*fac, iG=G*fac, iH=H*fac;

    const atk = Math.floor(iH*0.1 + iA + iD*0.1 + iG*0.05);
    const def = Math.floor(iH*0.1 + iA*0.1 + iD + iG*0.05);
    const agi = Math.floor(iG);
    const hp  = Math.floor(iH*4 + iA + iD + iG);

    if(hp===obs.hp && atk===obs.atk && def===obs.def && agi===obs.agi){
      matches++;
      if(ar+dr+gr+hr === 8) rank8++;
    }
  }

  return {matches, rank8};
}

/* -------- ë©”ì¸ ê³„ì‚° -------- */
function calcRank8(){

  const So = {
    hp:+$("soHp").value,
    atk:+$("soAtk").value,
    def:+$("soDef").value,
    agi:+$("soAgi").value,
  };

  const Î” = {
    hp:+$("dHp").value,
    atk:+$("dAtk").value,
    def:+$("dDef").value,
    agi:+$("dAgi").value,
  };

  const obs = {
    hp:So.hp + Î”.hp,
    atk:So.atk + Î”.atk,
    def:So.def + Î”.def,
    agi:So.agi + Î”.agi,
  };

  const k = +$("coefK").value;
  const u = {
    hp:+$("uHp").value,
    atk:+$("uAtk").value,
    def:+$("uDef").value,
    agi:+$("uAgi").value,
  };

  const R = enumerateAll(k, u, obs);

  const appear = R.matches / 178750 * 100;
  const success = R.matches ? (R.rank8 / R.matches * 100) : 0;

  $("resultBox").textContent =
`â–  Rank8 ê³„ì‚° ê²°ê³¼

ì´ ê²½ìš°ì˜ ìˆ˜: 178,750
ì¼ì¹˜ ì¡°í•©: ${R.matches}
Rank8 ì¡°í•©: ${R.rank8}

ì¶œí˜„ í™•ë¥ : ${appear.toFixed(5)} %
Rank8 ì„±ê³µ í™•ë¥ : ${success.toFixed(5)} %


`;
}

/* -------- ì´ˆê¸°í™” -------- */
function clearAll(){
  ["dHp","dAtk","dDef","dAgi"].forEach(id=>$(id).value="");
  $("resultBox").textContent="ì´ˆê¸°í™” ì™„ë£Œ.";
}

/* -------- ì´ë²¤íŠ¸ -------- */
window.onload = ()=>{
  loadData();
  $("petName").onchange = e => selectPet(e.target.value);
  $("btnCalc").onclick = calcRank8;
  $("btnClear").onclick = clearAll;
};
</script>

</body>
</html>
